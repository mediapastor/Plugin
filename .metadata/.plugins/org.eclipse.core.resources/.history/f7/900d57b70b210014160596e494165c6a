package com.tvd.gameview.views;

import org.eclipse.core.resources.IResource;
import org.eclipse.core.resources.IResourceChangeEvent;
import org.eclipse.core.resources.IResourceChangeListener;
import org.eclipse.core.resources.IResourceDelta;
import org.eclipse.core.resources.IResourceDeltaVisitor;
import org.eclipse.ui.part.ViewPart;

import com.tvd.gamview.ext.utils.ProjectUtils;

public class XMLFileChangeListener implements IResourceChangeListener {

	public XMLFileChangeListener(ViewPart viewPart) {
		mViewPart = viewPart;
	}
	
	@Override
	public void resourceChanged(IResourceChangeEvent event) {
		if(event.getSource() != null) {
			System.out.println("XMLFileChangeListener::resourceChanged::source instance of = " + event.getSource().getClass().getName()
					+ ", type = " + event.getType());
			IResource res = event.getResource();
	         switch (event.getType()) {
	            case IResourceChangeEvent.PRE_CLOSE:
	               System.out.print("Project ");
	               System.out.print(res.getFullPath());
	               System.out.println(" is about to close.");
	               break;
	            case IResourceChangeEvent.PRE_DELETE:
	               System.out.print("Project ");
	               System.out.print(res.getFullPath());
	               System.out.println(" is about to be deleted.");
	               break;
	            case IResourceChangeEvent.POST_CHANGE:
	               System.out.println("Resources have changed.");
	               event.getDelta().accept(new DeltaPrinter());
	               break;
	            case IResourceChangeEvent.PRE_BUILD:
	               System.out.println("Build about to run.");
	               event.getDelta().accept(new DeltaPrinter());
	               break;
	            case IResourceChangeEvent.POST_BUILD:
	               System.out.println("Build complete.");
	               event.getDelta().accept(new DeltaPrinter());
	               break;
	         }
	}

	private static class DeltaPrinter implements IResourceDeltaVisitor {
	      public boolean visit(IResourceDelta delta) {
	         IResource res = delta.getResource();
	         switch (delta.getKind()) {
	            case IResourceDelta.ADDED:
	               System.out.print("Resource ");
	               System.out.print(res.getFullPath());
	               System.out.println(" was added.");
	               break;
	            case IResourceDelta.REMOVED:
	               System.out.print("Resource ");
	               System.out.print(res.getFullPath());
	               System.out.println(" was removed.");
	               break;
	            case IResourceDelta.CHANGED:
	               System.out.print("Resource ");
	               System.out.print(res.getFullPath());
	               System.out.println(" has changed.");
	               break;
	         }
	         return true; // visit the children
	      }
	   }
	
	private ViewPart mViewPart;
	
}
